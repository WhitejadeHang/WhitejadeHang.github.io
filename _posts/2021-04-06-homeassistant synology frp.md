---
layout: post
title:  "[homeassistant]homeassistant在群晖上使用frp内网穿透"
date:   2021-04-06 22:22:00 +0800--
categories: [实践探索]
tags:   [homeassistant,NAS]
---

### 前言

接着昨天将homeassistant从树莓派迁移到群晖docker上的工作，今天来将数据库配置起来。

### 服务端

服务端的配置其实比较简单，因为前期我已经购买了腾讯云，做好了域名解析了，之前也用了frp了，还申请了证书的。

照理说这里应该没有任何问题，我就在腾讯云的控制台上确认了一下端口都开着的。

值得注意的是，服务端我配置了7000端口用于frp，同时配置了7005端口用于用服务器ip或网址打开面板，面板的用户名和密码也可以配置，用户名不配的话默认是admin。

这里我还做了自启动。

访问服务器7005，可以打开面板网页，说明服务端配置成功了。

### 客户端配置

客户端我使用的是docker，将群晖上的配置文件挂载到docker上即可，可以将在云服务申请的证书实装到NAS上，这样可以用https，注意的是，我刚配好的时候总是启动失败，有好几个原因。

一是加了注释的配置文件识别不对，最好把注释都给取消了。

二是如果要用http和https协议，是需要在服务器端配置vhost相关的配置的，这个我没做，所以先得用tcp协议。

三是在具体的端口配置上，至少在一个配置里需要加入custom_domain，不然也无法工作。

以上都没问题的话，内网穿透就基本可以使用了。

### 后续还需要配置的地方

首先是两端的token要配一下，增加安全性。

然后是https要做，这里就是我前面说到的vhost配置。

最后就是群晖和云服务上的防火墙了，有时间梳理一下需要用到的端口，可以把其他端口给关闭了。

### 参考文献

1.[Recorder](https://www.home-assistant.io/integrations/recorder)


  
 
___




<p align = "right">2021年4月5日</p>
<p align = "right">Hang</p>

